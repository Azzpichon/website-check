# ワークフローの名前
name: Manual Site Check

# 実行のきっかけを設定
on:
  workflow_dispatch:
    # ブラウザの画面に表示する入力欄を定義
    inputs:
      url:
        description: 'チェックしたいサイトのURL'
        required: true
        default: 'https://www.google.com/'
      # ↓↓↓ ここからが新しい部分っス！ ↓↓↓
      update_snapshots:
        description: 'お手本を更新する（チェックON）'
        type: boolean # チェックボックスになるおまじない
        default: false   # 普段はOFFになってる
      # ↑↑↑ ここまでが新しい部分っス！ ↑↑↑

# 実行するお仕事（ジョブ）を定義
jobs:
  playwright-test:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install dependencies
        run: npm ci

      - name: Install Playwright browsers
        run: npx playwright install --with-deps

      # ↓↓↓ ここのステップを賢く書き換えたっス！ ↓↓↓
      - name: Run Playwright tests
        run: |
          if [[ "${{ github.event.inputs.update_snapshots }}" == "true" ]]; then
            echo "お手本スナップショットを更新します..."
            npx playwright test --update-snapshots
          else
            echo "お手本スナップショットと比較します..."
            npx playwright test
          fi
        env:
          TARGET_URL: ${{ github.event.inputs.url }}
      # ↑↑↑ ここまでが新しい部分っス！ ↑↑↑

      - name: Upload report
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: playwright-report
          path: playwright-report/
          retention-days: 7